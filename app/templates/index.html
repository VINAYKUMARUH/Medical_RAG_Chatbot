<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üîç AI Medical Chatbot</title>
  <style>
    :root {
      --bg: #0f172a;               /* slate-900 */
      --panel: #0b1223a6;          /* translucent panel */
      --card: #ffffff;             /* light card */
      --muted: #64748b;            /* slate-500 */
      --accent: #22c55e;           /* emerald */
      --accent-2: #60a5fa;         /* blue-400 */
      --bubble-user: #dbeafe;      /* blue-100 */
      --bubble-assistant: #f8fafc; /* slate-50 */
      --danger: #ef4444;           /* red-500 */
      --ring: rgba(96,165,250,.55);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1020;
        --panel: #0b1223cc;
        --card: #0f172a;
        --muted: #94a3b8;
        --bubble-user: #1e3a8a;      /* blue-900 */
        --bubble-assistant: #0b1223;  /* panel */
      }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% -10%, #1e293b 0%, transparent 60%),
                  radial-gradient(1000px 700px at 110% 10%, #052e2b 0%, transparent 60%),
                  radial-gradient(800px 600px at 30% 110%, #0b1223 0%, transparent 60%), var(--bg);
      color: #0b1223;
    }

    .shell { min-height: 100%; display: grid; place-items: start center; padding: 2rem 1rem; }

    .chat-app {
      width: min(960px, 100%);
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(2,6,23,.35);
      border: 1px solid rgba(148,163,184,.25);
    }

    .hero {
      position: relative; padding: 1.25rem 1.5rem 1rem; color: white;
      background: linear-gradient(120deg, #16a34a, #2563eb 60%, #7c3aed);
      isolation: isolate;
    }
    .hero::after {
      content: ""; position: absolute; inset: 0; background: radial-gradient(600px 200px at 20% 0%, rgba(255,255,255,.25), transparent 60%);
      mix-blend-mode: screen; pointer-events: none;
    }
    .title-row { display: flex; align-items: center; gap: .75rem; }
    .logo {
      display: grid; place-items: center; width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,.15);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.2);
      font-size: 1.25rem;
    }
    h1 { margin: 0; font-size: clamp(1.1rem, 2.2vw, 1.4rem); letter-spacing: .2px; font-weight: 700; }
    .sub { margin: .35rem 0 0; font-size: .95rem; opacity: .85; }

    .body { display: grid; grid-template-columns: 1fr; }

    .chat-container { padding: 1.25rem; display: grid; grid-template-rows: auto auto auto; gap: 1rem; }

    .alert { display: none; }
    .alert.show { display: block; color: var(--danger); font-weight: 600; }

    #chat-box {
      background: linear-gradient(180deg, rgba(96,165,250,.08), transparent 20%),
                  linear-gradient(0deg, rgba(34,197,94,.08), transparent 30%);
      border: 1px solid rgba(148,163,184,.35);
      border-radius: 16px;
      height: min(60vh, 600px);
      overflow: auto;
      padding: 1rem;
      scroll-behavior: smooth;
    }
    /* smooth, thin scrollbar */
    #chat-box::-webkit-scrollbar { width: 10px; }
    #chat-box::-webkit-scrollbar-thumb { background: rgba(148,163,184,.6); border-radius: 999px; }
    #chat-box::-webkit-scrollbar-track { background: transparent; }

    .message { max-width: 82%; margin: .5rem 0; padding: .75rem .9rem; border-radius: 14px; line-height: 1.45; position: relative; word-wrap: break-word; }
    .row { display: flex; gap: .75rem; align-items: flex-end; }
    .row.user { justify-content: flex-end; }

    .bubble { box-shadow: 0 8px 24px rgba(2, 6, 23, .12); }
    .assistant .bubble { background: var(--bubble-assistant); border: 1px solid rgba(148,163,184,.35); }
    .user .bubble { background: var(--bubble-user); border: 1px solid rgba(37,99,235,.25); }

    .avatar { width: 36px; height: 36px; border-radius: 10px; background: rgba(2,6,23,.1); display: grid; place-items: center; font-size: 1.05rem; flex: none; }
    .avatar.user { background: rgba(37,99,235,.15); }
    .avatar.assistant { background: rgba(34,197,94,.15); }

    .meta { font-size: .8rem; color: var(--muted); margin-top: .25rem; }

    form.chat-input { background: linear-gradient(180deg, rgba(15,23,42,.04), transparent); padding: .25rem; display: grid; grid-template-columns: 1fr auto; gap: .5rem; align-items: start; }
    textarea {
      width: 100%; min-height: 3.25rem; max-height: 40vh; resize: vertical;
      padding: .85rem 1rem; font-size: 1rem; line-height: 1.35;
      border: 1px solid rgba(148,163,184,.6); border-radius: 14px;
      outline: none; background: #fff;
      box-shadow: 0 1px 0 rgba(2,6,23,.02);
    }
    textarea:focus { border-color: var(--accent-2); box-shadow: 0 0 0 4px var(--ring); }

    .actions { display: flex; gap: .5rem; align-items: center; }
    button {
      cursor: pointer; border: 0; border-radius: 12px; padding: .8rem 1rem; font-size: 1rem; font-weight: 600;
      background: linear-gradient(180deg, #22c55e, #16a34a); color: white;
      box-shadow: 0 10px 20px rgba(34,197,94,.25), inset 0 0 0 1px rgba(255,255,255,.25);
      transition: transform .06s ease, box-shadow .2s ease;
    }
    button:hover { box-shadow: 0 12px 26px rgba(34,197,94,.35); }
    button:active { transform: translateY(1px); }

    .ghost {
      background: linear-gradient(180deg, #e2e8f0, #cbd5e1); color: #0f172a;
      box-shadow: 0 10px 20px rgba(2,6,23,.08);
    }

    .footer { padding: .75rem 1rem 1.25rem; display: flex; justify-content: space-between; align-items: center; color: var(--muted); font-size: .9rem; }
    .badge { padding: .25rem .5rem; border-radius: 999px; border: 1px solid rgba(148,163,184,.4); background: rgba(248,250,252,.85); }

    /* Small bounce-in animation */
    @keyframes popIn { from { transform: translateY(6px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .message { animation: popIn .18s ease-out both; }

    /* Better rendering for Jinja injected HTML */
    .bubble p { margin: .4rem 0; }
    .bubble ul { margin: .4rem 1rem; }
    .bubble code { background: #0b12230f; padding: .1rem .35rem; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="shell">
    <div class="chat-app" role="application" aria-label="AI Medical Chatbot">
      <header class="hero">
        <div class="title-row">
          <div class="logo" aria-hidden="true">ü©∫</div>
          <div>
            <h1>AI Medical Chatbot</h1>
            <p class="sub">Ask health-related questions. This app is for informational purposes only and not a substitute for professional advice.</p>
          </div>
        </div>
      </header>

      <main class="body">
        <section class="chat-container">
          {% if error %}
            <div class="alert show" role="alert">{{ error }}</div>
          {% endif %}

          <div id="chat-box" aria-live="polite" aria-busy="false">
            {% for msg in messages %}
              <div class="row {{ msg.role }}">
                {% if msg.role == 'assistant' %}
                  <div class="avatar assistant" title="Assistant">ü§ñ</div>
                {% else %}
                  <div class="avatar user" title="You">üßë</div>
                {% endif %}

                <div class="message {{ msg.role }}">
                  <div class="bubble">
                    <strong style="display:block; margin-bottom:.25rem;">{{ msg.role|capitalize }}:</strong>
                    {{ msg.content | safe | nl2br }}
                  </div>
                  <div class="meta">
                    {# Optional timestamp support if you add it server-side: msg.ts #}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>

          <form class="chat-input" method="post" action="{{ url_for('index') }}">
            <label for="prompt" class="sr-only">Your question</label>
            <textarea id="prompt" name="prompt" placeholder="Ask a medical question‚Ä¶" required aria-label="Ask a medical question"></textarea>
            <div class="actions">
              <button type="submit" title="Send message">Send</button>
            </div>
          </form>

          <form method="get" action="{{ url_for('clear') }}">
            <button type="submit" class="ghost" title="Clear chat history">Clear Chat</button>
          </form>
        </section>
      </main>

      <footer class="footer">
        <span class="badge">v1.0</span>
        <span>üí° Tip: Avoid sharing personal identifiers. In emergencies, call local services.</span>
      </footer>
    </div>
  </div>

  <script>
    // Auto-scroll to bottom on load to show latest messages
    const chatBox = document.getElementById('chat-box');
    if (chatBox) {
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Submit on Cmd/Ctrl+Enter for quicker UX
    const ta = document.getElementById('prompt');
    if (ta) {
      ta.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
          e.preventDefault();
          e.target.form?.submit();
        }
      });
    }
  </script>
</body>
</html>
